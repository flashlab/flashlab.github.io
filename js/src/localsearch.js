var scrollTop="",newHeight="100",isfetched=!1,isXml=!0,search_path=CONFIG.path;0==search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path=CONFIG.root+search_path;function proceedsearch(){$("#local-search-input").val($("#search-input").val()),document.getElementById("local-search-input").dispatchEvent(new Event("input")),$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}$("#search-input").on("input",(function(){$(this).val().length<=0?$("#search-result").hide():($("i.search-keyword").text($(this).val()),$('a.search-result[href!="#"]').each((function(){this.href=this.href.replace(/\=(.*?)(?=%20site)/,"="+$("#search-input").val())})),$("#search-result").show())}));var searchFunc=function(e,t,s){"use strict";$.ajax({url:e,dataType:isXml?"xml":"json",async:!0,beforeSend:function(){$(".site-search-form>span").toggleClass("fa-spin"),$("#search-input").prop("disabled",(function(e,t){return!t}))},complete:function(){$(".site-search-form>span").toggleClass("fa-spin"),$("#search-input").prop("disabled",(function(e,t){return!t}))},success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",e).map((function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}})).get():e,r=document.getElementById(t),a=document.getElementById(s);r.addEventListener("input",(function(){var e=0,t='<ul class="search-result-list">',s=this.value.trim().toLowerCase().split(/[\s\-]+/);a.innerHTML="",this.value.trim().length>1&&n.forEach((function(n){var r=!1,a=n.title.trim().toLowerCase(),o=n.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),c=decodeURIComponent(n.url),i=-1,l=-1,h=-1;if(""!=a&&s.forEach((function(e,t){i=a.indexOf(e),l=o.indexOf(e),(i>=0||l>=0)&&(r=!0,0==t&&(h=l))})),r){e+=1,t+="<li><a href='"+c+"' class='search-result-title'>"+a+"</a>";var p=n.content.trim().replace(/<[^>]+>/g,"");if(h>=0){var u=h-20,d=h+80;u<0&&(u=0),0==u&&(d=50),d>p.length&&(d=p.length);var f=p.substring(u,d);s.forEach((function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")})),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}})),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==s&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),a.innerHTML=t})),proceedsearch()}})};$(window).bind("scroll",(function(){scrollTop=$(window).scrollTop(),newHeight=scrollTop+100})),$("#search-result a").mousedown((function(e){window.location.href=this.href})),$(".popup-trigger").mousedown((function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()})),$("#search-input").focus((function(){jQuery(window).width()<750&&$("body").animate({scrollTop:$(".site-search").offset().top},500),$(this).val().length>0&&$("#search-result").show()})),$("#search-input").blur((function(){$("#search-result").hide()})),$(".popup-btn-close").click((function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")})),$(".popup").click((function(e){e.stopPropagation()}));